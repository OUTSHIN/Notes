文件输入/输出
-------
#### 与文件进行通信
##### 标准文件
> C程序会自动打开3个文件，他们被称为标准输入，标准输出和标准错误输出

#### 标准I/O
> 优点：可移植，有许多专门函数简化了处理不同I/O的问题，输入和输出都是**缓冲**的

##### fopen()函数
> 程序使用fopen()函数打开文件。第一个参数是待打开文件的名称，第二个参数时一个字符串，是待打开文件的模式
  ```c
fopen(""hello.c",'r')
  ```
| 模式字符串 | 含义 |
|:----------|:----------|
|     "r"       |       以读模式打开文件     |
|      "w"      |     以写模式打开文件，把现有文件长度截为0，如果文件不存在，创建一个新文件       |
|      "a"    |   以写模式打开文件，在现有文件末尾添加内容，如果文件不存在，则创建一个新文件      |
|       "r+"     |   以更新模式打开文件（即可以读写文件）         |
|      "w+"      |      以更新模式打开文件（即，读和写），如果文件存在，则将其长度截为0；如果文件不存在，则创建一个新文件      |
|     "a+"       |   以更新模式打开文件（即，读和写），在现有文件的末尾添加内容，如果文件不存在则创建一个新文件；可以读整个文件，但是只能从末尾添加内容   |
|   "rb", "wb", "ab", "rb+", "r+b", "wb+", "w+b", "ab+", "a+b"      |         与上一个模式类似，但是以二进制模式而不是以文本模式打开文件   |
|     "wx", "wbx", "w+x", "wb+x"或"w+bxh"    |  （C11）类似非x模式，但是如果文件已经存在或以独占模式打开文件，则打开文件失败 |

- 传统的一种写模式打开现有文件，fopen()会把该文件长度截为0，丢失内容
- 使用带x字母的写模式，即使fopen()操作失败，原文件内容也不会删除
- 如果环境允许，x模式的独占性使得其他程序或线程无法访问正在被打开的文件
- 成功打开文件，fopen()返回文件指针
- 文件指针类型是指向FILE的指针（ `FILE * p;` ）

##### getc()和putc()函数
> 与getchar()和putchar()类似，需要告诉函数使用哪个文件

- getc()参数为文件指针
- putc()第一个参数为待写入的字符，第二个为文件指针
```
ch=getc (fp );
//从fp指定的文件中获取一个字符
putc (ch, fpout );
//把字符ch放入fpout指定的文件中
```

##### 文件结尾
> 如果getc()读取到文件结尾时返回特殊值 `EOF ` 

- 为避免读到空文件，应该使用入口条件循环（不是do while）进行文件输入
 `while((ch=getc(fp))!=EOF )` 

##### fclose()函数
> fclose(fp)函数关闭fp指定的文件，必要时刷新缓冲区
\n应检查是否成功关闭文件。如果成功关闭，返回0，否则返回EOF
##### 指向标准文件的指针
> stdio.h头文件把三个文件指针和三个标准文件关联，C程序会自动打开三个标准文件

| 标准文件 | 文件指针| 通常使用的设备 |
|:----------:|:----------:|:----------:|
|     标准输入     |      stdin      |     键盘       |
|      标准输出      |       stdout     |     显示器       |
|     标准错误输出       |     stderr       |      显示器      |

#### 一个简单的文件压缩程序
- 使用命令行参数打开文件很有用

#### 文件I/O
##### fprintf()和fscanf()
- 与printf()和scanf()类似，区别是需要用第一个参数指定待处理的文件

##### fgets()和fputs()
fgets() `fgets(buf, STLEN, fp)` 
  - 第一个参数表示储存输入位置的地址
  - 第二个参数是一个整数（STLEN），表示待输入字符串的**大小**（非长度，指所占字节数）
  - 最后一个参数是指定待读取文件的指针
  - fgets()函数读取输入直到第一个换行符的后面，或读到文件结尾，或者读取到STLEN-1个字符
  - 函数在末尾添加空字符使之成为一个字符串
  - 如果在读到字符上限前读完一行，会把换行符放到空字符前面
  - 遇到文件结尾返回NULL值

fputs() `fputs(buf, fp)` 
  - 第一个参数是字符串地址，第二个参数是文件指针
  - 不会在末尾添加换行符

#### 随机访问:fseek()和ftell()
> 有了fseek()，便可以把文件看做是数组，在fopen()打开的文件中直接移动任意字节处

##### 工作原理
###### fseek()  `fseek(fp, 0L, SEEK_END)` 

- 第一个参数是FILE指针，指向待查找的文件
- 第二个参数是偏移量，表示从起始点开始要移动的距离。必须是long类型的值，可以为正（前移），负（后移）或0（保持不动）
- 第三个参数是模式，该参数确定起点。在stdio.h中规定了几个表示模式的明示常量

| 模式 | 偏移量的起始点 |
|:----------:|:----------:|
|      SEEK_SET    |    文件开始处        |
|      SEEK_CUR      |       当前位置     |
|       SEEK_END     |      文件末尾      |

- 旧的实现可能不带这些定义，可以使用0L，1L，2L分别表示这三种模式
- 如果一切正常，fseek()返回值为0，如果出现错误，其返回值为-1

###### ftell()
- 适用于以二进制模式打开的文件
- ftell()的返回值为long类型，返回的是参数指向当前位置距文件开始处的字节数（文件第一个字节到文件开始处距离是0）

##### fgetpos()和fsetpos()函数
> fseek()和ftell()处理文件大小有限（long类型有限，可处理2.1g大小文件）

- 这两个新增函数用于处理较大文件，不使用long类型值表示位置，使用**fpos_t**
- fpos_t类型变量或数据对象可以在文件中指定一个位置，它**不能**是**数组类型**

###### fgetpos()原型
 ```
int fgetpos(FILE *restrict stream, fpos_t * restrict pos);
```
- 它把fpos_t类型的值放在pos指向的位置，描述了文件当前位置距文件开头的字节数
- 如果成功，返回0；失败则返回非0

###### fsetpos()原型
```
int fsetpos(FILE *stream, const fpost_t *pos);
```
- 使用pos指向位置上的fpos_t类型值来设置文件指针指向偏移该值后指定的位置
- 如果成功，返回0；如果失败，返回非0


